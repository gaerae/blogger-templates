/**
 * Related posts for Blogger Widget
 * @author gaerae
 * @version 1.0
 */
(function($,document){var HELPER_NAMESPACE=$("div.related-posts-widget");var CURRENT_URL;var OPTION={blog_url:"",max_posts:5,max_tags:5,posts_per_tag:5,title_use:true,thumb_use:true,thumb_default:"",thumb_size:"s72-c",tags:false,post_page_only:false,url_querystring:false,panel_title_related:"Related Posts",panel_title_recent:"Recent Posts",loading_class:"-related-posts-loading"};var RelatedPosts={enable:function(){RelatedPosts.onOption();RelatedPosts.onFeed()},onOption:function(){var _content,_option,_blog_url;if(HELPER_NAMESPACE){var _content=HELPER_NAMESPACE.html().replace(/\n|\r\n/g,"");if(_content){if((_content=_content.match(/<!--\s*(\{.+\});?\s*--\>/))&&_content.length==2)_content=_content[1];if(_content.indexOf("{")<0)_content="{"+_content+"}";try{_option=eval("("+_content+")")}catch(message){HELPER_NAMESPACE.html('<b style="color:red">'+message+"</b>");return false}OPTION=$.extend(OPTION,_option)}}if(OPTION.post_page_only?location.pathname.match(/^\/\d{4}\/\d\d\/[\w\-\_]+\.html/):true){CURRENT_URL=location.protocol+"//"+location.host+location.pathname+(OPTION.url_querystring?location.search:"")}},onFeed:function(){var e,t=OPTION.blog_url+"/feeds/posts/summary/";if(!OPTION.tags){OPTION.tags=[];$('a[rel="tag"]:lt('+OPTION.max_tags+")").each(function(){e=$.trim($(this).text().replace(/\n/g,""));if($.inArray(e,OPTION.tags)==-1)OPTION.tags[OPTION.tags.length]=e})}if(OPTION.tags.length==0){$.ajax({url:t,data:{"max-results":OPTION.max_posts,alt:"json-in-script"},success:RelatedPosts.onContent,dataType:"jsonp",cache:true})}else{for(var n=0,r=OPTION.tags.length;n<r;n++){$.ajax({url:t,data:{category:OPTION.tags[n],"max-results":OPTION.posts_per_tag,alt:"json-in-script"},success:RelatedPosts.onContent,dataType:"jsonp",cache:true})}}},onContent:function(e){var t,n,r,i,s,o=e.feed.entry.length;if(e.feed.entry){t=OPTION.tags.length==0?OPTION.panel_title_recent:OPTION.panel_title_related;n='<div class="panel panel-primary"><div class="panel-heading"><h3 class="panel-title">'+t+"</h3></div>";n+='<div class="panel-body '+OPTION.loading_class+'">';for(var u=0;u<o;u++){var a=e.feed.entry[u];e:{var f=0,l=a.link.length;for(l;f<l;f++){if(a.link[f].rel=="alternate"){i=a.link[f].href;break e}}}r=a.title.$t;s=a.media$thumbnail?a.media$thumbnail.url:OPTION.thumb_default;if(OPTION.thumb_size!="s72-c")s=s.replace("/s72-c/","/"+OPTION.thumb_size+"/");if(i!=CURRENT_URL||OPTION.tags.length==0){n+='<div class="col-xs-6 col-md-2"><a href="'+i+'" class="thumbnail">'+(OPTION.thumb_use&&s?'<img src="'+s+'" title="'+(OPTION.title_use?"":r)+'" border="0"/>':"")+(OPTION.title_use?r:"")+"</a></div>"}}n+="</div></div>";HELPER_NAMESPACE.html(n)}}};$(document).ready(RelatedPosts.enable)})(jQuery,document)
